<%- contentFor('body') %> 

<script src="../javascripts/chart/chart.js/dist/Chart.min.js"></script>
<script src="../javascripts/chart/chart.js/dist/util.js"></script>
<link rel="stylesheet" type="text/css" href="../javascripts/chart/chart.js/dist/Chart.css" />
<h1>Demanda de productos</h1>
<link rel="stylesheet" href="/stylesheets/reportes.css">
<canvas  class="grafico" id="myChart" ></canvas>
<script>
var ctx = document.getElementById('myChart');
var data =  <%- JSON.stringify(reportData) %>

const myChart = new Chart(document.getElementById("myChart"),{
	"type": "doughnut",
	"data": {
		"labels": data.labels,
		"datasets":[
			{
				"data": Object.values(data.report), 
				"backgroundColor":["rgb(255, 99, 132)","rgb(54, 162, 235)","rgb(255, 205, 86)"]
			}
		]
	}
});


window.onload = function() {
			var ctx = document.getElementById('myChart').getContext('2d');
			window.myLine = new Chart(ctx, config);
		};

		document.getElementById('randomizeData').addEventListener('click', function() {
			config.data.datasets.forEach(function(dataset) {
				dataset.data = dataset.data.map(function() {
					return randomScalingFactor();
				});

			});

			window.myLine.update();
		});

		var colorNames = Object.keys(window.chartColors);
		document.getElementById('addDataset').addEventListener('click', function() {
			var colorName = colorNames[config.data.datasets.length % colorNames.length];
			var newColor = window.chartColors[colorName];
			var newDataset = {
				label: 'Dataset ' + config.data.datasets.length,
				backgroundColor: newColor,
				borderColor: newColor,
				data: [],
				fill: false
			};

			for (var index = 0; index < config.data.labels.length; ++index) {
				newDataset.data.push(randomScalingFactor());
			}

			config.data.datasets.push(newDataset);
			window.myLine.update();
		});

		document.getElementById('addData').addEventListener('click', function() {
			if (config.data.datasets.length > 0) {
				var month = MONTHS[config.data.labels.length % MONTHS.length];
				config.data.labels.push(month);

				config.data.datasets.forEach(function(dataset) {
					dataset.data.push(randomScalingFactor());
				});

				window.myLine.update();
			}
		});

		document.getElementById('removeDataset').addEventListener('click', function() {
			config.data.datasets.splice(0, 1);
			window.myLine.update();
		});

		document.getElementById('removeData').addEventListener('click', function() {
			config.data.labels.splice(-1, 1); // remove the label first

			config.data.datasets.forEach(function(dataset) {
				dataset.data.pop();
			});

			window.myLine.update();
		});
</script>