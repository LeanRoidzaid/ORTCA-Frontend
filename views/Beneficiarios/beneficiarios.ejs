<%- contentFor('body') %> 
<style>
    .container {
  
      padding-top: 20px !important;
      padding-right: 0px !important;
      padding-left: 60px !important;
      margin-right: 0px !important;
      margin-left: 0px !important;
      padding-bottom: 0px !important;
  
    }
  
    .dahsboard {
      width: 1600px !important;
  
    }
  </style>
<script>
    function popularBeneficiarios(){
        $.ajax({
        
        url : '/beneficiarios/all',
        type : 'GET',
        dataType:'json',
        success : ejecutarLlenadoGrilla,
        error : function(request,error)
        {
            alert("Request: "+JSON.stringify(request));
        }
        });

    }
    function popularBeneficiariosByID(id){
        $.ajax({
        
        url : '/beneficiarios/getBEneficiarioById',
        type : 'GET',
        data : {
            'idBeneficiario' : id
        },
        dataType:'json',
        success : ejecutarLlenadoGrilla,
        error : function(request,error)
        {
            alert("Request: "+JSON.stringify(request));
        }
        });

    }
    function ejecutarLlenadoGrilla(data)
    {
        this.ancho = "1500";
        this.alto  = "800";
        $(div).jsGrid({
            width: this.ancho,
            height: this.alto,
           
          
            inserting: true,
            //rowDoubleClick: editar,
            sorting: true,
            paging: true,
            autoload: true,
            pageSize: 10,
            pageButtonCount: 5,
            pagerFormat: "Pages: {first} {prev} {pages} {next} {last}    {pageIndex} of {pageCount}",
        
            selecting: true,
            editing: true,
           // updatedItem:actualizar,
            invalidMessage: "No supera la validacion",
            
          
           // deleteItem: borrar,
            onItemInserting:insertar,
            onItemUpdating: actualizar,
            data: data ,
            controller: {
            loadData: function(filter) {
                var startIndex = (filter.pageIndex - 1) * filter.pageSize;
                //alert("asdas"+filter.usuario_roles);
                return ;//{
                    //data: db.clients.slice(startIndex, startIndex + filter.pageSize),
                    //itemsCount: db.clients.length
                //};
            }
            } ,
            fields: [
                { name: "id", title:"Id" , visible:false, type: "number", width: 5, validate: "required" },
                { name: "nombre", title:"Nombre" , type: "text", width: 60, validate: {
                    validator: "rangeLength",
                    message: function(value, item) {
                            return "El largo del campo Nombre debe ser entre 1 y 45";
                        },
                        param: [1, 45]
                    }
                 },
                { name: "apellido", title: "Apellido" ,type: "text", width: 60, 
                validate: {
                    validator: "rangeLength",
                        message: function(value, item) {
                            return "El largo del campo Apellido debe ser entre 1 y 45";
                        },
                        param: [1, 45]
                    }
                },
                { name: "dni",title:"DNI" ,type: "number", width: 30, 
                validate: {
                    validator: "range",
                    message: function(value, item) {
                        return "El numero del campo DNI debe ser entre 0 y 99999999 ";
                    },
                    param: [0, 99999999]
                }
                },
                { name: "telefono", title:"Telefono", type: "number", width: 60},
                { name: "usuario",visible:false,title:"Usuario", type: "text", width: 50, validate: "required" },
                { name: "fh_alta",title:"Fecha Alta" ,visible:false ,type: "text", width: 50, validate: "required" },
                { name: "fh_baja", visible:false, type: "text", width: 150},
                { name: "id", title:"Acciones",  align :"center",type: "select",  editing:false,  inserting: false, width: 80,
                
                itemTemplate: function(value) {
                    //return $("<div>").addClass("rating").append(Array(value + 1).join("&#9733;"));
                        return $("<button type='button' onclick=javascript:verAutorizados('"+value+"')>Ver Autorizados</button>").addClass("btn btn-primary");
                }
            },

                { type: "control", editButton: true, deleteButton:false}
            ]
        });


    }


   var grilla = {
    div : "",
    ancho : "",
    alto:"",


    crear :function (divP,ancho,alto,editar,borrar,insertar,actualizar){

        div   = divP;
        ancho = ancho;
        alto  = alto;

 

    },
    popular :popularBeneficiarios,
    llenarGrilla : ejecutarLlenadoGrilla

    }
    function editar(ars){
       // alert("editar")
    }







    var grillaAutorizados = {
    div : "",
    ancho : "",
    alto:"",


    crear :function (divP,ancho,alto,editar,borrar,insertar,actualizar){

        div   = divP;
        ancho = ancho;
        alto  = alto;

 

    },
    popular :popularAutorizados,
    llenarGrilla : ejecutarLlenadoGrillaAutorizados

    

    }


    function insertingAutorizado(arg) {


        if (arg.item.telefono) {
            var cadena = new String(arg.item.telefono);
            if (cadena.length != 13) {
                alert("El telefono debe tener al menos 13 digitos.");
                grillaAutorizados.popular();

            }
        }
        
            $.ajax({

                url: 'http://localhost:3000/beneficiarios/insertarAutorizado',
                type: 'POST',
                data: {
                    'nombre': arg.item.nombre,
                    'apellido': arg.item.apellido,
                    'usuario': arg.item.usuario,
                    'dni': arg.item.DNI,
                    'telefono': arg.item.telefono,
                    'idBeneficiario': $("#idBeneficiarioAutorizado").val()
                },
                dataType: 'json',
                success: function (data) {
                    if (data.staus != 200) {
                        // alert(data.error);

                    }
                    grillaAutorizados.popular($("#idBeneficiarioAutorizado").val());
                    alert("Autorizado ingresado exitosamente")
                    



                },
                error: function (request, error) {
                    if (JSON.parse(request.responseJSON).error) {
                        alert("Error al insertar  ");
                    }
                }
            });
        
            location.reload(true);

    }
    function editaAutorizado(arg){

        if(arg.item.telefono ){
            var cadena = new String(arg.item.telefono);
            if(cadena.length!=13 ){
                alert("El telefono debe tener al menos 13 digitos.");
                grillaAutorizados.popular();
                
            }
        }
    
    }
    
    function popularAutorizados(id){

        $("#idBeneficiarioAutorizado").val(id);

        $.ajax({

            url: '/beneficiarios/autorizadosById',
            type: 'GET',
            data: {
                'idbeneficiario': id
            },
            dataType: 'json',
            success: ejecutarLlenadoGrillaAutorizados,
            error: function (request, error) {
                alert("Request: " + JSON.stringify(request));
            }
        });
      
    }
    function ejecutarLlenadoGrillaAutorizados(data){
        this.ancho = "900";
        this.alto = "600";
        $(div).jsGrid({
            width: this.ancho,
            height: this.alto,
            autoload: true,
            pageLoading: true,
            inserting: true,
           // rowDoubleClick: editar,
            sorting: true,
            paging: true,
            selecting: true,
            editing: false,
            // updatedItem:actualizar,
            noDataContent: "Sin Datos...",
            invalidMessage: "No supera la validacion",

            // deleteItem: borrar,
            onItemInserting: insertingAutorizado,
            onItemUpdating: editaAutorizado,
            data: data.autorizados,
            controller: {
                loadData: function (filter) {
                    var startIndex = (filter.pageIndex - 1) * filter.pageSize;
                    return;
                }
            },
            fields: [
                { name: "id_beneficiario", title: "idBeneficiario", visible: false, type: "number", width: 5, validate: "required" },
                { name: "id", title: "Id", visible: false, type: "number", width: 5, validate: "required" },
                {
                    name: "nombre", title: "Nombre", type: "text", width: 60, validate: {
                        validator: "rangeLength",
                        message: function (value, item) {
                            return "El largo del campo Nombre debe ser entre 1 y 45";
                        },
                        param: [1, 45]
                    }
                },
                {
                    name: "apellido", title: "Apellido", type: "text", width: 60,
                    validate: {
                        validator: "rangeLength",
                        message: function (value, item) {
                            return "El largo del campo Apellido debe ser entre 1 y 45";
                        },
                        param: [1, 45]
                    }
                },
                {
                    name: "DNI", title: "DNI", type: "number", width: 40,
                    validate: {
                        validator: "range",
                        message: function (value, item) {
                            return "El largo del campo DNI debe ser 8 digitos";
                        },
                        param: [1, 99999999]
                    }
                },
                { name: "telefono", title: "Telefono", type: "number", width: 60 },
                { name: "usuario", visible: false, title: "Usuario", type: "text", width: 50, validate: "required" },
                { name: "fh_alta", title: "Fecha Alta", visible: false, type: "text", width: 50, validate: "required" },
                { name: "fh_baja", visible: false, type: "text", width: 150 },
                { type: "control", editButton: false, deleteButton:false }
            ]
        });


    }




        function verAutorizados(ars) {
            //alert("editar");
            grillaAutorizados.crear("#jsGridAutorizados", "900", "1200", null, null, null, null);
            grillaAutorizados.popular(ars);
            $('#AutorizadoModal').modal();
        }


        function actualizar(datos) {
           // alert("Funcionalidad no implementada");
           if(datos.item.telefono ){
            var cadena = new String(datos.item.telefono);
            if(cadena.length!=13 ){
                alert("El telefono debe tener al menos 13 digitos.");
                grilla.popular();
                return false;
            }
        }
            $.ajax({

                url: 'http://localhost:3000/beneficiarios/actualizar',
                type: 'POST',
                data: {
                    'nombre': datos.item.nombre,
                    'apellido': datos.item.apellido,
                    'usuario': datos.item.usuario,
                    'dni': datos.item.dni,
                    'telefono': datos.item.telefono,
                    'id':datos.item.id
                },
                dataType: 'json',
                success: function (data) {
                    if (data.staus != 200) {
                        // alert(data.error);

                    }
                    alert("Beneficiario actualizado exitosamente");
                    grilla.popular();



                },
                error: function (request, error) {
                    if (JSON.parse(request.responseJSON).error) {
                        alert("Error al actualizar");
                    }
                }
            });



        }

    function insertar(datos) {
        if(datos.item.telefono ){
            var cadena = new String(datos.item.telefono);
            if(cadena.length!=13 ){
                alert("El telefono debe tener al menos 13 digitos.");
                grilla.popular();
                return false;
            }
        }

            $.ajax({

                url: 'http://localhost:3000/beneficiarios/insertar',
                type: 'POST',
                data: {
                    'nombre': datos.item.nombre,
                    'apellido': datos.item.apellido,
                    'usuario': datos.item.usuario,
                    'dni': datos.item.dni,
                    'telefono': datos.item.telefono,
                },
                dataType: 'json',
                success: function (data) {
                    if (data.staus != 200) {
                        // alert(data.error);

                    }
                    alert("Beneficiario ingresado exitosamente")
                    grilla.popular();



                },
                error: function (request, error) {
                    if (JSON.parse(request.responseJSON).error) {
                        alert("Error al insertar compruebe que no ingresando un beneficiario con el DNI repetido ");
                    }
                }
            });


            grilla.popular();

    





 }



    $(document).ready(function() {  


        $('#AutorizadoModal').on('hidden.bs.modal', function (e) {
            // do something...
            
           location.reload(true);
        });

        
        grilla.crear("#jsGrid","900","1200",null,null,null,null);
        grilla.popular();

        /*
        
        
            $.ajax({
        
                    url : 'http://localhost:3000/usuarios/all',
                    type : 'GET',
                    data : {
                        'numberOfWords' : 10
                    },
                    dataType:'json',
                    success : bindData,
                    error : function(request,error)
                    {
                        alert("Request: "+JSON.stringify(request));
                    }
                });
        
        */
       








    });



        $(document).on('focus', '#buscarOrden', function () {

            $(this).autocomplete({
                //source have a url of a service
                source: '../ordenes/getOrdenByBusqueda',
                select: function (event, ui) {
                    event.preventDefault();
                    // alert(ui.item.value); // start an alert which contains the value of proposal
                    //this.value = ui.item.label;
                    //generarGrillaByBenef(ui.item.value);
                    popularBeneficiariosByID(ui.item.value);
                    //alert("ui.item.value: "+ui.item.value+" ui.item.label:"+ui.item.label);
                    $(this).val(ui.item.label);
                },
                minLength: 1//min = 2 characters
            });
        }); 
        
        function limpiarGrilla(){
            $("#buscarOrden").val("");
            popularBeneficiarios();
        }

    </script>
        
        
       
        
        <link type="text/css" rel="stylesheet" href="../stylesheets/jsgrid.min.css" />
        <link type="text/css" rel="stylesheet" href="../stylesheets/jsgrid-theme.min.css" />
            
        <script type="text/javascript" src="../javascripts/jsgrid/jsgrid.min.js"></script>
        
        <h2>Beneficiarios</h2>
        <p>
            <table>
                <td width="700px"  ><input type="text" id="buscarOrden" name="buscarOrden" class="form-control"  placeholder="Nombre, Apellido o DNI del Beneficiario"></td>
                <td> &nbsp;<input type="image" width="30px" height="30px" id="limpiarGrilla" name="limpiarGrilla"  onclick="javascritp:limpiarGrilla()"  value="Recargar"  src="data:image/png;base64,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"></td>
            </table>
                
                
        </p>

        <br>
        <div id="jsGrid" ></div>
        

        <div class="modal fade" id="AutorizadoModal" tabindex="-1" role="dialog" aria-labelledby="RolesModalLabel" aria-hidden="true">
                <div class="modal-dialog  modal-xl" role="document">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title" id="RolesModalLabel">Autorizados</h5>
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                      </button>
                    </div>
                    <div class="modal-body">
                      <form>
                        
                        <!--
                        <button type="button" class="btn btn-primary" onclick="agregar();">Agregar Auroizado</button>-->
                        <div class="form-group">
                        <input type="hidden" id="idBeneficiarioAutorizado"/>
                      
                        <div id="jsGridAutorizados" ></div>

                                
        
                        </div>
                      </form>
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                     
                    </div>
                  </div>
                </div>
              </div>
        
   
        